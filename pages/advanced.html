<!DOCTYPE html><html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VueDart: Advanced topics</title>
  <link rel="icon" href="favicon.ico">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <script src="../dist/vendor.js"></script>

  <script defer="" src="docs.initialize.dart.js"></script>
  

  <style>
    #content { padding: 0em 1em; }
    .md-layout { flex-wrap: nowrap !important; }
    .highlight .err { border: 0px !important; }
    pre { overflow-x: auto; }
    [v-cloak] { display: none; }
    a:visited:not(.md-button) { color: blue; }
  </style>
</head>

<body>
  <div id="app" v-cloak="">
    <site-navbar nested=""></site-navbar>

    <md-layout md-row="" md-column-small="">
      <docs-navlist></docs-navlist>

      <div id="content" v-pre="">
        <h1>Advanced topics</h1><div id="assets"></div>
<h2>Bundling your assets via Aspen</h2>
<p>All the examples thus far have manually loaded Vue:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>VueDart first example<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="c">&lt;!-- Here --&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://unpkg.com/vue"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">type</span><span class="o">=</span><span class="s">"application/dart"</span> <span class="na">src</span><span class="o">=</span><span class="s">"index.dart"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</pre></div>

<p>Obviously, once you start to throw in plugins and UI libraries, this doesn't scale
well:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://unpkg.com/vue"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://unpkg.com/vue-router"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">"https://unpkg.com/vue-material"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"https://unpkg.com/vue-material/dist/vue-material.css"</span><span class="p">&gt;</span>
</pre></div>

<p>The preferred way to bundle these assets together is via
<a href="https://pub.dartlang.org/packages/aspen">Aspen</a> + yarn/npm. Install Aspen via:</p>
<pre><code>$ pub global activate aspen
</code></pre>
<p>and add <code>aspen_assets</code> to your <code>pubspec.yaml</code>:</p>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">dependencies</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">aspen_assets</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
  <span class="l l-Scalar l-Scalar-Plain">vue2</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
</pre></div>

<p>Now run <code>yarn init</code> to set up your <code>package.json</code>, and <code>yarn add</code> your dependencies:</p>
<pre><code>$ yarn init
# Follow the prompts
$ yarn add vue
$ yarn add vue-router
# and so forth...
</code></pre>
<p>Now create a file named <code>aspen.yml</code> containing something like the following:</p>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">targets</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web/vendor.js</span>

    <span class="l l-Scalar l-Scalar-Plain">assets</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dev</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/vue/dist/vue.js</span>
      <span class="l l-Scalar l-Scalar-Plain">prod</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/vue/dist/vue.min.js</span>
</pre></div>

<p>This says that when bundling in development mode, <code>vue.js</code> will be used, else
<code>vue.min.js</code> will be used. This and any others assets will be bundled into
<code>web/vendor.js</code>.</p>
<p>Other assets can be added too:</p>
<div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">targets</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">outputs</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">web/vendor.js</span>

    <span class="l l-Scalar l-Scalar-Plain">assets</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dev</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/vue/dist/vue.js</span>
      <span class="l l-Scalar l-Scalar-Plain">prod</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/vue/dist/vue.min.js</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dev</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/vue-material/dist/vue-material.debug.js</span>
      <span class="l l-Scalar l-Scalar-Plain">prod</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/vue-material/dist/vue-material.js</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">vue-material-css</span>
      <span class="c1"># 'default' is used to declare the same file for both dev and prod</span>
      <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">node_modules/vue-material/dist/vue-material.css</span>
</pre></div>

<p>Notice that <code>vue-material-css</code> is named; this is because CSS assets are not
automatically applied to the document (similar to Webpack). In order to do so,
you need to use <code>aspen_assets</code>:</p>
<div class="highlight"><pre><span></span><span class="k">import</span> <span class="s1">'package:vue2/vue.dart'</span><span class="p">;</span>
<span class="k">import</span> <span class="s1">'package:aspen_assets/aspen_assets.dart'</span> <span class="k">as</span> <span class="n">aspen</span><span class="p">;</span>

<span class="c1">// ..</span>

<span class="n">Future</span> <span class="n">main</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="c1">// This will apply the style to the document.</span>
  <span class="n">aspen</span><span class="p">.</span><span class="n">loadGlobal</span><span class="p">(</span><span class="s1">'vue-material-css'</span><span class="p">);</span>

  <span class="kd">await</span> <span class="n">initVue</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>

<p>In order to bundle the assets, run <code>aspen</code>, or <code>aspen -m prod</code> to bundle in production
mode. Now only <code>vendor.js</code> needs to be included:</p>
<pre><code>&lt;script src="vendor.js"&gt;&lt;/script&gt;
</code></pre>
<p>If you're using the VueDart CLI, you can use <code>vuedart create my-project --aspen</code> to
create a new project that uses Aspen and npm/Yarn instead of the default that uses
the unpkg CDN.</p><div id="boundary"></div>
<h2>Crossing the JavaScript and Dart boundary</h2>
<p>This is one of the trickier things you'll need to know to use VueDart efficiently. Going
back to the <code>show-name</code> component from the last section, what if you wanted a property
value to be an object? For instance:</p>
<div class="highlight"><pre><span></span><span class="c1">// DO NOT DO THIS; IT DOESN'T WORK</span>

<span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>

  <span class="n">Person</span><span class="p">({</span><span class="k">this</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">age</span><span class="p">});</span>
<span class="p">}</span>

<span class="nd">@VueComponent</span><span class="p">(</span><span class="nl">name:</span> <span class="s1">'show-name'</span><span class="p">,</span> <span class="nl">template:</span> <span class="s1">'&lt;p&gt;{{person.name}} is {{person.age}}&lt;/p&gt;'</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">ShowName</span> <span class="kd">extends</span> <span class="n">VueComponentBase</span> <span class="p">{</span>
  <span class="n">ShowName</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

  <span class="nd">@prop</span>
  <span class="n">Person</span> <span class="n">person</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>If you couldn't tell by the giant warning comment...this won't work. The problem here is
that the JavaScript world doesn't see objects like the Dart world does. The answer to this
dilemma is <a href="https://pub.dartlang.org/packages/js">the js package</a>.</p>
<p>Before you continue, look through the package documentation (especially the <em>JavaScript
object literals</em> section) and the Chart.js example.</p>
<p>Now, with that in mind, here's how you'd do the above <em>properly</em>:</p>
<div class="highlight"><pre><span></span><span class="nd">@anonymous</span>
<span class="nd">@JS</span><span class="p">()</span>
<span class="kd">class</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="kt">String</span> <span class="n">name</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>

  <span class="n">external</span> <span class="n">Person</span><span class="p">({</span><span class="kt">String</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Since <code>@anonymous</code> is declaring a normal JavaScript anonymous object, this version of
<code>Person</code> will survive being passed over the JS-and-Dart boundary. You can use basic types,
like <code>String</code>, <code>int</code>, and <code>List</code>.</p>
<p>Another thing to note: <em>you cannot put maps in your objects if you plan to use them from the
JS side</em>. For instance, this won't work:</p>
<div class="highlight"><pre><span></span><span class="c1">// DON'T DO THIS</span>

<span class="nd">@anonymous</span>
<span class="nd">@JS</span><span class="p">()</span>
<span class="kd">class</span> <span class="nc">Things</span> <span class="p">{</span>
  <span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="n">things</span><span class="p">;</span>

  <span class="n">external</span> <span class="n">Person</span><span class="p">({</span><span class="n">Map</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="n">things</span><span class="p">});</span>
<span class="p">}</span>
</pre></div>

<p>Instead, you need to use <code>package:js/js_util.dart</code>, whose documentation is (confusingly!)
available under the name
<a href="https://api.dartlang.org/stable/dart-js_util/dart-js_util-library.html"><code>dart:js_util</code></a>,
and the <code>mapToJs</code> helper function. Here's a concrete example:</p>
<div class="highlight"><pre><span></span><span class="nd">@anonymous</span>
<span class="nd">@JS</span><span class="p">()</span>
<span class="kd">class</span> <span class="nc">Things</span> <span class="p">{</span>
  <span class="c1">// Use 'dynamic' to reference JavaScript objects.</span>
  <span class="kt">dynamic</span> <span class="n">things</span><span class="p">;</span>

  <span class="n">external</span> <span class="n">Person</span><span class="p">({</span><span class="kt">dynamic</span> <span class="n">things</span><span class="p">});</span>
<span class="p">}</span>

<span class="c1">// ...</span>

<span class="c1">// Now we want to create a new instance of Things</span>
<span class="k">new</span> <span class="n">Things</span><span class="p">(</span>
  <span class="nl">things:</span> <span class="n">mapToJs</span><span class="p">({</span>
    <span class="s1">'thing1'</span><span class="o">:</span> <span class="s1">'value'</span><span class="p">,</span>
    <span class="s1">'thing2'</span><span class="o">:</span> <span class="s1">'value'</span><span class="p">,</span>
  <span class="p">}),</span>
<span class="p">)</span>
</pre></div>

<p><code>mapToJs</code> converts a Dart map to a standard JavaScript object. After this, use the <code>js_util</code>
functions to access the properties on the object (such as <code>getProperty</code> and <code>setProperty</code>).</p>
<p>All this seems rather complex, but once you've got it down, you'll be passing objects around
in no time!!</p><div id="instance"></div>
<h2>Events via $emit, and other instance methods</h2>
<p>VueDart supports the <code>$emit</code>, <code>$on</code>, <code>$off</code>, and <code>$once</code> functions:</p>
<div class="highlight"><pre><span></span><span class="nd">@VueComponent</span><span class="p">(</span><span class="nl">name:</span> <span class="s1">'my-component'</span><span class="p">,</span> <span class="nl">template:</span> <span class="s1">'&lt;button @click="click"&gt;Click me!&lt;/button&gt;'</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">MyComponent</span> <span class="kd">extends</span> <span class="n">VueComponentBase</span> <span class="p">{</span>
  <span class="n">MyComponent</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

  <span class="nd">@method</span>
  <span class="kt">void</span> <span class="n">click</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">$emit</span><span class="p">(</span><span class="s1">'my-custom-event'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'some arg'</span><span class="p">,</span> <span class="s1">'some other arg'</span><span class="p">]);</span>

    <span class="n">$on</span><span class="p">(</span><span class="s1">'something'</span><span class="p">,</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="m">123</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="c1">// Same for $off and $once</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>In addition, <code>$nextTick</code>, <code>$forceUpdate</code>, and <code>$destroy</code> are also supported:</p>
<div class="highlight"><pre><span></span><span class="nd">@VueComponent</span><span class="p">(</span><span class="nl">name:</span> <span class="s1">'my-component'</span><span class="p">,</span> <span class="nl">template:</span> <span class="s1">'&lt;&lt;'</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">MyComponent</span> <span class="kd">extends</span> <span class="n">VueComponentBase</span> <span class="p">{</span>
  <span class="n">MyComponent</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

  <span class="nd">@method</span>
  <span class="kt">void</span> <span class="n">click</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $nextTick returns a Future</span>
    <span class="n">$nextTick</span><span class="p">().</span><span class="n">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="n">print</span><span class="p">(</span><span class="s1">'In </span><span class="se">\$</span><span class="s1">nextTick callback!'</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// $forceUpdate is simple</span>
    <span class="n">$forceUpdate</span><span class="p">();</span>
    <span class="c1">// same for $destroy</span>
    <span class="n">$destroy</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
<div id="render"></div>
<h2>Render functions</h2>
<p><strong>Note that render functions in VueDart right now are rather suboptimal from a Dart-ish-ness
perspective; they will eventually be improved, and this section will be rewritten.</strong></p>
<p>To declare a custom render function, you just leave out the <code>template:</code> value and override
the <code>render</code> method:</p>
<div class="highlight"><pre><span></span><span class="nd">@VueComponent</span><span class="p">(</span><span class="nl">name:</span> <span class="s1">'my-component'</span><span class="p">)</span> <span class="c1">// &lt;-- no template!</span>
<span class="kd">class</span> <span class="nc">MyComponent</span> <span class="kd">extends</span> <span class="n">VueComponentBase</span> <span class="p">{</span>
  <span class="n">MyComponent</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">:</span> <span class="k">super</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

  <span class="nd">@override</span>
  <span class="kt">void</span> <span class="n">render</span><span class="p">(</span><span class="n">CreateElement</span> <span class="n">createElement</span><span class="p">)</span> <span class="o">=&gt;</span>
    <span class="c1">// function body goes here</span>
<span class="p">}</span>
</pre></div>

<p>The hard part isn't <em>declaring</em> it though: it's <em>writing</em> it. Here's an example:</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">render</span><span class="p">(</span><span class="n">CreateElement</span> <span class="n">createElement</span><span class="p">)</span> <span class="o">=&gt;</span>
  <span class="n">createElement</span><span class="p">(</span><span class="s1">'div'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'style'</span><span class="o">:</span> <span class="n">mapToJs</span><span class="p">({</span><span class="s1">'color'</span><span class="o">:</span> <span class="s1">'red'</span><span class="p">})},</span>
                <span class="s1">'div contents here'</span><span class="p">);</span>
</pre></div>

<p>The main difference here in comparison to vanilla Vue is the <code>mapToJs</code> function: although
the outer maps are converted automatically, the inner maps aren't. In this case, the
<code>{'style': ...}</code> map is automatically converted, but the <code>{'color': 'red'}</code> map isn't.</p>
<p>Other than that, just note that all the return values here are <code>dynamic</code>, and if
you make a mistake, Dart's type system isn't going to be there to save you when it fails.
Beware!</p><div id="migrate"></div>
<h2>Using the VueDart CLI to perform migrations</h2>
<p>VueDart's CLI also comes with a simple tool to help with version migrations. Just run
<code>vuedart migrate</code> like so:</p>
<pre><code>$ vuedart migrate . pubspec.yaml web/* lib/*
</code></pre>
<p>The first argument is the root directory of your project; the rest of the arguments
are the source files that should be included in the migration. To include everything,
just do something like this:</p>
<pre><code>$ find * -not -path '*/\.*' -type f | xargs vuedart migrate .
</code></pre><div id="ignore"></div>
<h2>Ignoring elements</h2>
<p>The VueDart equivalent of <code>Vue.config.ignoredElements</code> is <code>VueConfig.ignoredElements</code>:</p>
<div class="highlight"><pre><span></span><span class="kt">void</span> <span class="n">main</span><span class="p">()</span> <span class="kd">async</span> <span class="p">{</span>
  <span class="n">VueConfig</span><span class="p">.</span><span class="n">ignoredElements</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'my-element'</span><span class="p">];</span>
  <span class="kd">await</span> <span class="n">initVue</span><span class="p">();</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</pre></div>

      </div>
    </md-layout>
  </div>

</body></html>